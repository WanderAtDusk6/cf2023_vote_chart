<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sorted Data Visualization</title>
  <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>

</head>
<body>
  <div style="max-width: 600px; margin: auto;">
    <canvas id="myChart"></canvas>
    <p id="difference"></p>
  </div>

  <script>
    fetch('https://vipact.api.mgtv.com/api/v1/act/vote/charlist?act_name=20230414cf2023&count=50&invoker=mobile-zhifubao&_dx_seq_id=59a8d4cc-f895-f8cf-8e47-cf2f0dfba64c&v=v4')
      .then(response => response.json())
      .then((data) => {
        // 提取角色列表数据
        const characterList = data.data.character_list

    // 按照票数从高到低对角色列表进行排序
    characterList.sort((a, b) => b.vote_num - a.vote_num)

    // 取前 5 名角色数据
    const top5 = characterList.slice(0, 5)

    // 使用 Chart.js 展示数据
    const ctx = document.getElementById('myChart').getContext('2d')
    const myChart = new Chart(ctx, {
          type: 'horizontalBar',
          data: {
            labels: top5.map(item => item.char_name),
            datasets: [{
              label: 'Top 5 Characters by Votes',
              data: top5.map(item => item.vote_num),
              backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)'],
              borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'],
              borderWidth: 1,
            }],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              xAxes: [{
                ticks: {
                  beginAtZero: true,
                },
              }],
            },
          },
    })

    // 计算票数差距和百分比
    const maxVotes = top5[0].vote_num
    const minVotes = top5[4].vote_num
    const difference = maxVotes - minVotes
    const percentage = (difference / maxVotes * 100).toFixed(2)

    // 显示票数差距和百分比
    const differenceElement = document.getElementById('difference')
    differenceElement.textContent = `Votes difference between top 5: ${difference} (${percentage}%)`
  })
  </script>
</body>
</html>
